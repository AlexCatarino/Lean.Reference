<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lean: Common/Securities/Option/OptionFilterUniverse.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Lean
   &#160;<span id="projectnumber">$LEAN_TAG$</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('OptionFilterUniverse_8cs_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">OptionFilterUniverse.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * QUANTCONNECT.COM - Democratizing Finance, Empowering Individuals.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Lean Algorithmic Trading Engine v2.0. Copyright 2014 QuantConnect Corporation.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * limitations under the License.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">using</span> System;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">using</span> System.Linq;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html#acc7f7c0d72467529ed61916871bd54b6aa7f5f35426b927411fc9231b56382173" title="Python Language Project (4)">Python</a>.Runtime;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Data.html">Data</a>;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Data.html">Data</a>.<a class="code" href="namespaceQuantConnect_1_1Data_1_1UniverseSelection.html">UniverseSelection</a>;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Securities.html">Securities</a>.<a class="code" href="namespaceQuantConnect_1_1Securities_1_1FutureOption.html">FutureOption</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Securities.html">Securities</a>.<a class="code" href="namespaceQuantConnect_1_1Securities_1_1IndexOption.html">IndexOption</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceQuantConnect.html">QuantConnect</a>.<a class="code" href="namespaceQuantConnect_1_1Securities.html">Securities</a>.<a class="code" href="namespaceQuantConnect_1_1Securities_1_1Option.html">Option</a>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceQuantConnect_1_1Securities.html">QuantConnect.Securities</a></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;{<span class="comment"></span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">    /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">    /// Represents options symbols universe used in filtering.</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">    /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html">   32</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> : <a class="code" href="classQuantConnect_1_1Securities_1_1ContractSecurityFilterUniverse.html" title="Base class for contract symbols filtering universes. Used by OptionFilterUniverse and FutureFilterUni...">ContractSecurityFilterUniverse</a>&lt;OptionFilterUniverse, OptionUniverse&gt;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Securities_1_1Option_1_1Option.html" title="Option Security Object Implementation for Option Assets">Option</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1Option_1_1Option.html#ae39ce21662f04ff4ba26c754e0b33c23" title="Constructor for the option security">Option</a> _option;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="comment">// Fields used in relative strikes filter</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="keyword">private</span> List&lt;decimal&gt; _uniqueStrikes;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">bool</span> _refreshUniqueStrikes;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        <span class="keyword">private</span> DateTime _lastExchangeDate;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="keyword">private</span> readonly decimal _underlyingScaleFactor = 1;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">        /// The underlying price data</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb1b1353d6f1a21bf8c0aa95e82393d9">   45</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html" title="Abstract base data class of QuantConnect. It is intended to be extended to define generic user custom...">BaseData</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb1b1353d6f1a21bf8c0aa95e82393d9" title="The underlying price data">UnderlyingInternal</a> { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">        /// The underlying price data</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html" title="Abstract base data class of QuantConnect. It is intended to be extended to define generic user custom...">BaseData</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a></div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366">   51</a></span>&#160;        {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            <span class="keyword">get</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb1b1353d6f1a21bf8c0aa95e82393d9" title="The underlying price data">UnderlyingInternal</a>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">        /// Constructs OptionFilterUniverse</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">        /// &lt;param name=&quot;option&quot;&gt;The canonical option chain security&lt;/param&gt;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb13b7e2b9e6e9b2e59df656faf1f46f">   62</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb13b7e2b9e6e9b2e59df656faf1f46f" title="Constructs OptionFilterUniverse">OptionFilterUniverse</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Option_1_1Option.html" title="Option Security Object Implementation for Option Assets">Option</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1Option_1_1Option.html#ae39ce21662f04ff4ba26c754e0b33c23" title="Constructor for the option security">Option</a> option)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            _option = option;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            _underlyingScaleFactor = option.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#a263c21a2e10e769d5ecbb35877524ef2" title="Gets the symbol properties for this security">SymbolProperties</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SymbolProperties.html#a52e6a8730fbd2b5c32cf7d95f0a47e90" title="Scale factor for option&#39;s strike price. For some options, such as NQX, the strike price is based on a...">StrikeMultiplier</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">        /// Constructs OptionFilterUniverse</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">        /// &lt;remarks&gt;Used for testing only&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a467e71760dc6dc5d5c7312e3ac5c2f53">   72</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a467e71760dc6dc5d5c7312e3ac5c2f53" title="Constructs OptionFilterUniverse">OptionFilterUniverse</a>(<a class="code" href="classQuantConnect_1_1Securities_1_1Option_1_1Option.html" title="Option Security Object Implementation for Option Assets">Option</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1Option_1_1Option.html#ae39ce21662f04ff4ba26c754e0b33c23" title="Constructor for the option security">Option</a> option, IEnumerable&lt;OptionUniverse&gt; allData, <a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html" title="Abstract base data class of QuantConnect. It is intended to be extended to define generic user custom...">BaseData</a> underlying, decimal underlyingScaleFactor = 1)</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            : base(allData, underlying.EndTime)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            _option = option;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb1b1353d6f1a21bf8c0aa95e82393d9" title="The underlying price data">UnderlyingInternal</a> = underlying;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            _refreshUniqueStrikes = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            _underlyingScaleFactor = underlyingScaleFactor;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">        /// Refreshes this option filter universe and allows specifying if the exchange date changed from last call</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">        /// &lt;param name=&quot;allContractsData&quot;&gt;All data for the option contracts&lt;/param&gt;</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">        /// &lt;param name=&quot;underlying&quot;&gt;The current underlying last data point&lt;/param&gt;</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">        /// &lt;param name=&quot;localTime&quot;&gt;The current local time&lt;/param&gt;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a939e1f5bbeab3c34370ce8320a5db4ab">   87</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a939e1f5bbeab3c34370ce8320a5db4ab" title="Refreshes this option filter universe and allows specifying if the exchange date changed from last ca...">Refresh</a>(IEnumerable&lt;OptionUniverse&gt; allContractsData, <a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html" title="Abstract base data class of QuantConnect. It is intended to be extended to define generic user custom...">BaseData</a> underlying, DateTime localTime)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            base.Refresh(allContractsData, localTime);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb1b1353d6f1a21bf8c0aa95e82393d9" title="The underlying price data">UnderlyingInternal</a> = underlying;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            _refreshUniqueStrikes = _lastExchangeDate != localTime.Date;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            _lastExchangeDate = localTime.Date;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">        /// Determine if the given Option contract symbol is standard</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">        /// &lt;returns&gt;True if standard&lt;/returns&gt;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a954c7f72326b4a248dd5a8be194cc971">  100</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a954c7f72326b4a248dd5a8be194cc971" title="Determine if the given Option contract symbol is standard">IsStandard</a>(<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">switch</span> (symbol.<a class="code" href="classQuantConnect_1_1Symbol.html#a4b811550395ad9af00dacee29bde4125" title="Gets the security type of the symbol">SecurityType</a>)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.FutureOption:</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1FutureOption_1_1FutureOptionSymbol.html" title="Static helper methods to resolve Futures Options Symbol-related tasks.">FutureOptionSymbol</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1FutureOption_1_1FutureOptionSymbol.html#acb77dd2df85b8f6888341b5c4aead554" title="Detects if the future option contract is standard, i.e. not weekly, not short-term,...">IsStandard</a>(symbol);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespaceQuantConnect.html#a5b278afcdcc479a49e001f7ea24b1eb2" title="Type of tradable security / underlying asset">SecurityType</a>.IndexOption:</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1IndexOption_1_1IndexOptionSymbol.html" title="Index Option Symbol">IndexOptionSymbol</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1IndexOption_1_1IndexOptionSymbol.html#a9e4c837b281398267ad070d9d89555df" title="Determines if the Index Option Symbol is for a monthly contract">IsStandard</a>(symbol);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1Option_1_1OptionSymbol.html" title="Static class contains common utility methods specific to symbols representing the option contracts">OptionSymbol</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1Option_1_1OptionSymbol.html#a67479caa555c9b1c103efabf3e7e038c" title="Returns true if the option is a standard contract that expires 3rd Friday of the month">IsStandard</a>(symbol);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">        /// Gets the symbol from the data</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">        /// &lt;returns&gt;The symbol that represents the datum&lt;/returns&gt;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a2e59c895dc1f58303df42d61a0262724">  117</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a2e59c895dc1f58303df42d61a0262724" title="Gets the symbol from the data">GetSymbol</a>(<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1OptionUniverse.html" title="Represents a universe of options data">OptionUniverse</a> data)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordflow">return</span> data.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#a21f1d1df500aba939d967a99e7beb15c" title="Symbol representation for underlying Security">Symbol</a>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">        /// Creates a new instance of the data type for the given symbol</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">        /// &lt;returns&gt;A data instance for the given symbol&lt;/returns&gt;</span></div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a6713a3813d431e9469b25e5503f4c5c0">  126</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1OptionUniverse.html" title="Represents a universe of options data">OptionUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a6713a3813d431e9469b25e5503f4c5c0" title="Creates a new instance of the data type for the given symbol">CreateDataInstance</a>(<a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> symbol)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1OptionUniverse.html" title="Represents a universe of options data">OptionUniverse</a>()</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                <a class="code" href="classQuantConnect_1_1Symbol.html" title="Represents a unique security identifier. This is made of two components, the unique SID and the Value...">Symbol</a> = symbol,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                <a class="code" href="classQuantConnect_1_1Time.html" title="Time helper class collection for working with trading dates">Time</a> = <a class="code" href="classQuantConnect_1_1Securities_1_1ContractSecurityFilterUniverse.html#af79f405310518bc57e545073c53603fe" title="The local exchange current time">LocalTime</a></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            };</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">        /// Adjusts the date to the next trading day if the current date is not a trading day, so that expiration filter is properly applied.</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">        /// e.g. Selection for Mondays happen on Friday midnight (Saturday start), so if the minimum time to expiration is, say 0,</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">        /// contracts expiring on Monday would be filtered out if the date is not properly adjusted to the next trading day (Monday).</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">        /// &lt;param name=&quot;referenceDate&quot;&gt;The date to be adjusted&lt;/param&gt;</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">        /// &lt;returns&gt;The adjusted date&lt;/returns&gt;</span></div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a6b904ddd36b8b48bd39fee778ad67d5c">  142</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> DateTime <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a6b904ddd36b8b48bd39fee778ad67d5c" title="Adjusts the date to the next trading day if the current date is not a trading day,...">AdjustExpirationReferenceDate</a>(DateTime referenceDate)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="comment">// Check whether the reference time is a tradable date:</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="keywordflow">if</span> (!_option.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#ad5d411f6c563907f51580d0ab17a1643" title="Gets the SecurityExchangeHours for this exchange">Hours</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html#a9938e951dadf16e7518f648ff9c4a040" title="Determines if the exchange will be open on the date specified by the local date time">IsDateOpen</a>(referenceDate))</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                referenceDate = _option.<a class="code" href="classQuantConnect_1_1Securities_1_1Security.html#af6d256e4946a031d7bc394f2f5287001" title="Exchange class contains the market opening hours, along with pre-post market hours.">Exchange</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchange.html#ad5d411f6c563907f51580d0ab17a1643" title="Gets the SecurityExchangeHours for this exchange">Hours</a>.<a class="code" href="classQuantConnect_1_1Securities_1_1SecurityExchangeHours.html#a4477fb584df63bf4353438275aa8f678" title="Gets the next trading day">GetNextTradingDay</a>(referenceDate);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordflow">return</span> referenceDate;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">        /// Applies filter selecting options contracts based on a range of strikes in relative terms</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">        /// &lt;param name=&quot;minStrike&quot;&gt;The minimum strike relative to the underlying price, for example, -1 would filter out contracts further than 1 strike below market price&lt;/param&gt;</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">        /// &lt;param name=&quot;maxStrike&quot;&gt;The maximum strike relative to the underlying price, for example, +1 would filter out contracts further than 1 strike above market price&lt;/param&gt;</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a549322e5df6cb41049564a3251644978">  159</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a549322e5df6cb41049564a3251644978" title="Applies filter selecting options contracts based on a range of strikes in relative terms">Strikes</a>(<span class="keywordtype">int</span> minStrike, <span class="keywordtype">int</span> maxStrike)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb1b1353d6f1a21bf8c0aa95e82393d9" title="The underlying price data">UnderlyingInternal</a> == <span class="keyword">null</span>)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <span class="keywordflow">if</span> (_refreshUniqueStrikes || _uniqueStrikes == <span class="keyword">null</span>)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                <span class="comment">// Each day we need to recompute the unique strikes list.</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                _uniqueStrikes = AllSymbols.Select(x =&gt; x.ID.StrikePrice)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                    .Distinct()</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                    .OrderBy(strikePrice =&gt; strikePrice)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    .ToList();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                _refreshUniqueStrikes = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="comment">// find the current price in the list of strikes</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="comment">// When computing the strike prices we need to take into account</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="comment">// that some option&#39;s strike prices are based on a fraction of</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="comment">// the underlying. Thus we need to scale the underlying internal</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="comment">// price so that we can find it among the strike prices</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="comment">// using BinarySearch() method(as it is used below)</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            var exactPriceFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            var index = _uniqueStrikes.BinarySearch(<a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb1b1353d6f1a21bf8c0aa95e82393d9" title="The underlying price data">UnderlyingInternal</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a> / _underlyingScaleFactor);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="comment">// Return value of BinarySearch (from MSDN):</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="comment">// The zero-based index of item in the sorted List&lt;T&gt;, if item is found;</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <span class="comment">// otherwise, a negative number that is the bitwise complement of the index of the next element that is larger than item</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <span class="comment">// or, if there is no larger element, the bitwise complement of Count.</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keywordflow">if</span> (index &lt; 0)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                <span class="comment">// exact price not found</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                exactPriceFound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                <span class="keywordflow">if</span> (index == ~_uniqueStrikes.Count)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                    <span class="comment">// there is no greater price, return empty</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                    <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                index = ~index;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="comment">// compute the bounds, no need to worry about rounding and such</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            var indexMinPrice = index + minStrike;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            var indexMaxPrice = index + maxStrike;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">if</span> (!exactPriceFound)</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <span class="keywordflow">if</span> (minStrike &lt; 0 &amp;&amp; maxStrike &gt; 0)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    indexMaxPrice--;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (minStrike &gt; 0)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                    indexMinPrice--;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                    indexMaxPrice--;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="keywordflow">if</span> (indexMinPrice &lt; 0)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                indexMinPrice = 0;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (indexMinPrice &gt;= _uniqueStrikes.Count)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                <span class="comment">// price out of range: return empty</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordflow">if</span> (indexMaxPrice &lt; 0)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <span class="comment">// price out of range: return empty</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">if</span> (indexMaxPrice &gt;= _uniqueStrikes.Count)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                indexMaxPrice = _uniqueStrikes.Count - 1;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            var minPrice = _uniqueStrikes[indexMinPrice];</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            var maxPrice = _uniqueStrikes[indexMaxPrice];</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            Data = Data</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                .Where(data =&gt;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                        var price = data.ID.StrikePrice;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                        <span class="keywordflow">return</span> price &gt;= minPrice &amp;&amp; price &lt;= maxPrice;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                ).ToList();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">        /// Sets universe of call options (if any) as a selection</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a8eb08a377efbaa172eb19453f67e35a3">  257</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a8eb08a377efbaa172eb19453f67e35a3" title="Sets universe of call options (if any) as a selection">CallsOnly</a>()</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1ContractSecurityFilterUniverse.html#afd19f07e15021e294e3d72a992b4f634" title="Explicitly sets the selected contract symbols for this universe. This overrides and and all other met...">Contracts</a>(contracts =&gt; contracts.Where(x =&gt; x.Symbol.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call));</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">        /// Sets universe of put options (if any) as a selection</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#af5ee3de90d832118b96ad67ad4b55068">  266</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#af5ee3de90d832118b96ad67ad4b55068" title="Sets universe of put options (if any) as a selection">PutsOnly</a>()</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1ContractSecurityFilterUniverse.html#afd19f07e15021e294e3d72a992b4f634" title="Explicitly sets the selected contract symbols for this universe. This overrides and and all other met...">Contracts</a>(contracts =&gt; contracts.Where(x =&gt; x.Symbol.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put));</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">        /// Sets universe of a single call contract with the closest match to criteria given</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">        /// &lt;param name=&quot;strikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Naked Call, Covered Call, and Protective Call Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a1235311ca58ef456d41576a36d79b31f">  278</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a1235311ca58ef456d41576a36d79b31f" title="Sets universe of a single call contract with the closest match to criteria given">NakedCall</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal strikeFromAtm = 0)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">return</span> SingleContract(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call, minDaysTillExpiry, strikeFromAtm);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">        /// Sets universe of a single put contract with the closest match to criteria given</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">        /// &lt;param name=&quot;strikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Naked Put, Covered Put, and Protective Put Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a92daed9ad6d9f80f79418a93e2a76359">  290</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a92daed9ad6d9f80f79418a93e2a76359" title="Sets universe of a single put contract with the closest match to criteria given">NakedPut</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal strikeFromAtm = 0)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordflow">return</span> SingleContract(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put, minDaysTillExpiry, strikeFromAtm);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> SingleContract(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a> right, <span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal strikeFromAtm = 0)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="comment">// Select the expiry as the nearest to set days later</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            var contractsForExpiry = GetContractsForExpiry(AllSymbols, minDaysTillExpiry);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            var contracts = contractsForExpiry.Where(x =&gt; x.ID.OptionRight == right).ToList();</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            <span class="keywordflow">if</span> (contracts.Count == 0)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="comment">// Select strike price</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            var strike = GetStrike(contracts, strikeFromAtm);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            var selected = contracts.Single(x =&gt; x.ID.StrikePrice == strike);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keywordflow">return</span> SymbolList(<span class="keyword">new</span> List&lt;Symbol&gt; { selected });</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">        /// Sets universe of 2 call contracts with the same expiry and different strike prices, with closest match to the criteria given</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">        /// &lt;param name=&quot;higherStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the higher strike price&lt;/param&gt;</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">        /// &lt;param name=&quot;lowerStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the lower strike price&lt;/param&gt;</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Bear Call Spread and Bull Call Spread Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00320"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a7ad939f35de840331ee5ae92af808f2a">  320</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a7ad939f35de840331ee5ae92af808f2a" title="Sets universe of 2 call contracts with the same expiry and different strike prices,...">CallSpread</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal higherStrikeFromAtm = 5, decimal? lowerStrikeFromAtm = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordflow">return</span> Spread(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call, minDaysTillExpiry, higherStrikeFromAtm, lowerStrikeFromAtm);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">        /// Sets universe of 2 put contracts with the same expiry and different strike prices, with closest match to the criteria given</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">        /// &lt;param name=&quot;higherStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the higher strike price&lt;/param&gt;</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">        /// &lt;param name=&quot;lowerStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the lower strike price&lt;/param&gt;</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Bear Put Spread and Bull Put Spread Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00333"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ad7250899f6198c5d803589dee7788e24">  333</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ad7250899f6198c5d803589dee7788e24" title="Sets universe of 2 put contracts with the same expiry and different strike prices,...">PutSpread</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal higherStrikeFromAtm = 5, decimal? lowerStrikeFromAtm = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="keywordflow">return</span> Spread(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put, minDaysTillExpiry, higherStrikeFromAtm, lowerStrikeFromAtm);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> Spread(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a> right, <span class="keywordtype">int</span> minDaysTillExpiry, decimal higherStrikeFromAtm, decimal? lowerStrikeFromAtm = <span class="keyword">null</span>)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="keywordflow">if</span> (!lowerStrikeFromAtm.HasValue)</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                lowerStrikeFromAtm = -higherStrikeFromAtm;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            <span class="keywordflow">if</span> (higherStrikeFromAtm &lt;= lowerStrikeFromAtm)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;Spread(): strike price arguments must be in descending order, &quot;</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                    + $<span class="stringliteral">&quot;{nameof(higherStrikeFromAtm)}, {nameof(lowerStrikeFromAtm)}&quot;</span>);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="comment">// Select the expiry as the nearest to set days later</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            var contractsForExpiry = GetContractsForExpiry(AllSymbols, minDaysTillExpiry);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            var contracts = contractsForExpiry.Where(x =&gt; x.ID.OptionRight == right).ToList();</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordflow">if</span> (contracts.Count == 0)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="comment">// Select the strike prices with the set spread range</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            var lowerStrike = GetStrike(contracts, (decimal)lowerStrikeFromAtm);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            var lowerStrikeContract = contracts.Single(x =&gt; x.ID.StrikePrice == lowerStrike);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            var higherStrikeContracts = contracts.Where(x =&gt; x.ID.StrikePrice &gt; lowerStrike).ToList();</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <span class="keywordflow">if</span> (higherStrikeContracts.Count == 0)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            var higherStrike = GetStrike(higherStrikeContracts, higherStrikeFromAtm);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            var higherStrikeContract = higherStrikeContracts.Single(x =&gt; x.ID.StrikePrice == higherStrike);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <span class="keywordflow">return</span> SymbolList(<span class="keyword">new</span> List&lt;Symbol&gt; { lowerStrikeContract, higherStrikeContract });</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">        /// Sets universe of 2 call contracts with the same strike price and different expiration dates, with closest match to the criteria given</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">        /// &lt;param name=&quot;strikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">        /// &lt;param name=&quot;minNearDaysTillExpiry&quot;&gt;The mininum days till expiry of the closer contract from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">        /// &lt;param name=&quot;minFarDaysTillExpiry&quot;&gt;The mininum days till expiry of the further conrtact from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Long and Short Call Calendar Spread Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00382"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ac914026e835066d87c1c9ab7baaa7aea">  382</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ac914026e835066d87c1c9ab7baaa7aea" title="Sets universe of 2 call contracts with the same strike price and different expiration dates,...">CallCalendarSpread</a>(decimal strikeFromAtm = 0, <span class="keywordtype">int</span> minNearDaysTillExpiry = 30, <span class="keywordtype">int</span> minFarDaysTillExpiry = 60)</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="keywordflow">return</span> CalendarSpread(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call, strikeFromAtm, minNearDaysTillExpiry, minFarDaysTillExpiry);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">        /// Sets universe of 2 put contracts with the same strike price and different expiration dates, with closest match to the criteria given</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">        /// &lt;param name=&quot;strikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">        /// &lt;param name=&quot;minNearDaysTillExpiry&quot;&gt;The mininum days till expiry of the closer contract from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">        /// &lt;param name=&quot;minFarDaysTillExpiry&quot;&gt;The mininum days till expiry of the further conrtact from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Long and Short Put Calendar Spread Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a5c1dd8cc18ee2ee45c425183620099c4">  395</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a5c1dd8cc18ee2ee45c425183620099c4" title="Sets universe of 2 put contracts with the same strike price and different expiration dates,...">PutCalendarSpread</a>(decimal strikeFromAtm = 0, <span class="keywordtype">int</span> minNearDaysTillExpiry = 30, <span class="keywordtype">int</span> minFarDaysTillExpiry = 60)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="keywordflow">return</span> CalendarSpread(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put, strikeFromAtm, minNearDaysTillExpiry, minFarDaysTillExpiry);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> CalendarSpread(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a> right, decimal strikeFromAtm, <span class="keywordtype">int</span> minNearDaysTillExpiry, <span class="keywordtype">int</span> minFarDaysTillExpiry)</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordflow">if</span> (minFarDaysTillExpiry &lt;= minNearDaysTillExpiry)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;CalendarSpread(): expiry arguments must be in ascending order, &quot;</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    + $<span class="stringliteral">&quot;{nameof(minNearDaysTillExpiry)}, {nameof(minFarDaysTillExpiry)}&quot;</span>);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">if</span> (minNearDaysTillExpiry &lt; 0)</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;CalendarSpread(): near expiry argument must be positive.&quot;</span>);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <span class="comment">// Select the set strike</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            var strike = GetStrike(AllSymbols, strikeFromAtm);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            var contracts = AllSymbols.Where(x =&gt; x.ID.StrikePrice == strike &amp;&amp; x.ID.OptionRight == right).ToList();</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="comment">// Select the expiries</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            var nearExpiryContract = GetContractsForExpiry(contracts, minNearDaysTillExpiry).SingleOrDefault();</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">if</span> (nearExpiryContract == <span class="keyword">null</span>)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            var furtherContracts = contracts.Where(x =&gt; x.ID.Date &gt; nearExpiryContract.ID.Date).ToList();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            var farExpiryContract = GetContractsForExpiry(furtherContracts, minFarDaysTillExpiry).SingleOrDefault();</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="keywordflow">if</span> (farExpiryContract == <span class="keyword">null</span>)</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="keywordflow">return</span> SymbolList(<span class="keyword">new</span> List&lt;Symbol&gt; { nearExpiryContract, farExpiryContract });</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">        /// Sets universe of an OTM call contract and an OTM put contract with the same expiry, with closest match to the criteria given</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">        /// &lt;param name=&quot;callStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the OTM call. It must be positive.&lt;/param&gt;</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">        /// &lt;param name=&quot;putStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the OTM put. It must be negative.&lt;/param&gt;</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Long and Short Strangle Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00442"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aa4657b2ec4cf3d16519b7436335c9599">  442</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aa4657b2ec4cf3d16519b7436335c9599" title="Sets universe of an OTM call contract and an OTM put contract with the same expiry,...">Strangle</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal callStrikeFromAtm = 5, decimal putStrikeFromAtm = -5)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            <span class="keywordflow">if</span> (callStrikeFromAtm &lt;= 0)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException($<span class="stringliteral">&quot;Strangle(): {nameof(callStrikeFromAtm)} must be positive&quot;</span>);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keywordflow">if</span> (putStrikeFromAtm &gt;= 0)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException($<span class="stringliteral">&quot;Strangle(): {nameof(putStrikeFromAtm)} must be negative&quot;</span>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keywordflow">return</span> CallPutSpread(minDaysTillExpiry, callStrikeFromAtm, putStrikeFromAtm, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">        /// Sets universe of an ATM call contract and an ATM put contract with the same expiry, with closest match to the criteria given</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Long and Short Straddle Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ae6a5e2645c9742ef163dee1a3e062d20">  463</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ae6a5e2645c9742ef163dee1a3e062d20" title="Sets universe of an ATM call contract and an ATM put contract with the same expiry,...">Straddle</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="keywordflow">return</span> CallPutSpread(minDaysTillExpiry, 0, 0);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">        /// Sets universe of a call contract and a put contract with the same expiry but lower strike price, with closest match to the criteria given</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">        /// &lt;param name=&quot;callStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the call.&lt;/param&gt;</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">        /// &lt;param name=&quot;putStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the put.&lt;/param&gt;</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Protective Collar Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00476"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a12b1bb456df9f4f9bbe62a22b5cc6bc2">  476</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a12b1bb456df9f4f9bbe62a22b5cc6bc2" title="Sets universe of a call contract and a put contract with the same expiry but lower strike price,...">ProtectiveCollar</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal callStrikeFromAtm = 5, decimal putStrikeFromAtm = -5)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="keywordflow">if</span> (callStrikeFromAtm &lt;= putStrikeFromAtm)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;ProtectiveCollar(): strike price arguments must be in descending order, &quot;</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                    + $<span class="stringliteral">&quot;{nameof(callStrikeFromAtm)}, {nameof(putStrikeFromAtm)}&quot;</span>);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            var filtered = CallPutSpread(minDaysTillExpiry, callStrikeFromAtm, putStrikeFromAtm);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            var callStrike = filtered.Single(x =&gt; x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call).ID.StrikePrice;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            var putStrike = filtered.Single(x =&gt; x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put).ID.StrikePrice;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keywordflow">if</span> (callStrike &lt;= putStrike)</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <span class="keywordflow">return</span> filtered;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        }</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">        /// Sets universe of a call contract and a put contract with the same expiry and strike price, with closest match to the criteria given</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">        /// &lt;param name=&quot;strikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Conversion and Reverse Conversion Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00503"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a1aba87bfe855a2abfda28f500fa91659">  503</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a1aba87bfe855a2abfda28f500fa91659" title="Sets universe of a call contract and a put contract with the same expiry and strike price,...">Conversion</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal strikeFromAtm = 5)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <span class="keywordflow">return</span> CallPutSpread(minDaysTillExpiry, strikeFromAtm, strikeFromAtm);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> CallPutSpread(<span class="keywordtype">int</span> minDaysTillExpiry, decimal callStrikeFromAtm, decimal putStrikeFromAtm, <span class="keywordtype">bool</span> otm = <span class="keyword">false</span>)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            <span class="comment">// Select the expiry as the nearest to set days later</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            var contracts = GetContractsForExpiry(AllSymbols, minDaysTillExpiry).ToList();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160; </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            var calls = contracts.Where(x =&gt; x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call).ToList();</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            var puts = contracts.Where(x =&gt; x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put).ToList();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">if</span> (otm)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                calls = calls.Where(x =&gt; x.ID.StrikePrice &gt; <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a>).ToList();</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                puts = puts.Where(x =&gt; x.ID.StrikePrice &lt; <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a>).ToList();</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">if</span> (calls.Count == 0 || puts.Count == 0)</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="comment">// Select the strike prices with the set spread range</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            var callStrike = GetStrike(calls, callStrikeFromAtm);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            var call = calls.Single(x =&gt; x.ID.StrikePrice == callStrike);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            var putStrike = GetStrike(puts, putStrikeFromAtm);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            var put = puts.Single(x =&gt; x.ID.StrikePrice == putStrike);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <span class="comment">// Select the contracts</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="keywordflow">return</span> SymbolList(<span class="keyword">new</span> List&lt;Symbol&gt; { call, put });</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">        /// Sets universe of an ITM call, an ATM call, and an OTM call with the same expiry and equal strike price distance, with closest match to the criteria given</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">        /// &lt;param name=&quot;strikeSpread&quot;&gt;The desire strike price distance of the ITM call and the OTM call from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Long and Short Call Butterfly Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00544"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a43d552678d1ada202ac55db834fb2616">  544</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a43d552678d1ada202ac55db834fb2616" title="Sets universe of an ITM call, an ATM call, and an OTM call with the same expiry and equal strike pric...">CallButterfly</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal strikeSpread = 5)</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <span class="keywordflow">return</span> Butterfly(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call, minDaysTillExpiry, strikeSpread);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">        /// Sets universe of an ITM put, an ATM put, and an OTM put with the same expiry and equal strike price distance, with closest match to the criteria given</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">        /// &lt;param name=&quot;strikeSpread&quot;&gt;The desire strike price distance of the ITM put and the OTM put from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Long and Short Put Butterfly Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00556"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a0096b89bcecd34a248defaee4c94e2cb">  556</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a0096b89bcecd34a248defaee4c94e2cb" title="Sets universe of an ITM put, an ATM put, and an OTM put with the same expiry and equal strike price d...">PutButterfly</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal strikeSpread = 5)</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            <span class="keywordflow">return</span> Butterfly(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put, minDaysTillExpiry, strikeSpread);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160; </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> Butterfly(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a> right, <span class="keywordtype">int</span> minDaysTillExpiry, decimal strikeSpread)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <span class="keywordflow">if</span> (strikeSpread &lt;= 0)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;ProtectiveCollar(): strikeSpread arguments must be positive&quot;</span>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            <span class="comment">// Select the expiry as the nearest to set days later</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            var contractsForExpiry = GetContractsForExpiry(AllSymbols, minDaysTillExpiry);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            var contracts = contractsForExpiry.Where(x =&gt; x.ID.OptionRight == right).ToList();</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <span class="keywordflow">if</span> (contracts.Count == 0)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="comment">// Select the strike prices with the set spread range</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            var atmStrike = GetStrike(contracts, 0m);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            var lowerStrike = GetStrike(contracts.Where(x =&gt; x.ID.StrikePrice &lt; <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a> &amp;&amp; x.ID.StrikePrice &lt; atmStrike), -strikeSpread);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            var upperStrike = -1m;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="keywordflow">if</span> (lowerStrike != decimal.MaxValue)</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                upperStrike = atmStrike * 2 - lowerStrike;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <span class="comment">// Select the contracts</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            var filtered = this.Where(x =&gt;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                x.ID.Date == contracts[0].ID.Date &amp;&amp; x.ID.OptionRight == right &amp;&amp;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                (x.ID.StrikePrice == atmStrike || x.ID.StrikePrice == lowerStrike || x.ID.StrikePrice == upperStrike));</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <span class="keywordflow">if</span> (filtered.Count() != 3)</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <span class="keywordflow">return</span> filtered;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">        /// Sets universe of an OTM call, an ATM call, an ATM put, and an OTM put with the same expiry and equal strike price distance, with closest match to the criteria given</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">        /// &lt;param name=&quot;strikeSpread&quot;&gt;The desire strike price distance of the OTM call and the OTM put from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Long and Short Iron Butterfly Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00603"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ae7677cd42e6650927b0d436bd7663d05">  603</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ae7677cd42e6650927b0d436bd7663d05" title="Sets universe of an OTM call, an ATM call, an ATM put, and an OTM put with the same expiry and equal ...">IronButterfly</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal strikeSpread = 5)</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="keywordflow">if</span> (strikeSpread &lt;= 0)</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;IronButterfly(): strikeSpread arguments must be positive&quot;</span>);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            <span class="comment">// Select the expiry as the nearest to set days later</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            var contracts = GetContractsForExpiry(AllSymbols, minDaysTillExpiry).ToList();</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            var calls = contracts.Where(x =&gt; x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call &amp;&amp; x.ID.StrikePrice &gt; <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a>).ToList();</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            var puts = contracts.Where(x =&gt; x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put &amp;&amp; x.ID.StrikePrice &lt; <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a>).ToList();</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <span class="keywordflow">if</span> (calls.Count == 0 || puts.Count == 0)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            <span class="comment">// Select the strike prices with the set spread range</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            var atmStrike = GetStrike(contracts, 0);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            var otmCallStrike = GetStrike(calls.Where(x =&gt; x.ID.StrikePrice &gt; atmStrike), strikeSpread);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            var otmPutStrike = -1m;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="keywordflow">if</span> (otmCallStrike != decimal.MaxValue)</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                otmPutStrike = atmStrike * 2 - otmCallStrike;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            var filtered = this.Where(x =&gt;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                x.ID.Date == contracts[0].ID.Date &amp;&amp; (</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                x.ID.StrikePrice == atmStrike ||</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                (x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call &amp;&amp; x.ID.StrikePrice == otmCallStrike) ||</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                (x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put &amp;&amp; x.ID.StrikePrice == otmPutStrike)</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            ));</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="keywordflow">if</span> (filtered.Count() != 4)</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="keywordflow">return</span> filtered;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">        /// Sets universe of a far-OTM call, a near-OTM call, a near-OTM put, and a far-OTM put with the same expiry</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">        /// and equal strike price distance between both calls and both puts, with closest match to the criteria given</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">        /// &lt;param name=&quot;nearStrikeSpread&quot;&gt;The desire strike price distance of the near-to-expiry call and the near-to-expiry put from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">        /// &lt;param name=&quot;farStrikeSpread&quot;&gt;The desire strike price distance of the further-to-expiry call and the further-to-expiry put from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Long and Short Iron Condor Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aaaf1447705385a4d93b16cd4d5f7dcd7">  651</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aaaf1447705385a4d93b16cd4d5f7dcd7" title="Sets universe of a far-OTM call, a near-OTM call, a near-OTM put, and a far-OTM put with the same exp...">IronCondor</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal nearStrikeSpread = 5, decimal farStrikeSpread = 10)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            <span class="keywordflow">if</span> (nearStrikeSpread &lt;= 0 || farStrikeSpread &lt;= 0)</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            {</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;IronCondor(): strike arguments must be positive, &quot;</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                    + $<span class="stringliteral">&quot;{nameof(nearStrikeSpread)}, {nameof(farStrikeSpread)}&quot;</span>);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160; </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            <span class="keywordflow">if</span> (nearStrikeSpread &gt;= farStrikeSpread)</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;IronCondor(): strike arguments must be in ascending orders, &quot;</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                    + $<span class="stringliteral">&quot;{nameof(nearStrikeSpread)}, {nameof(farStrikeSpread)}&quot;</span>);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            }</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="comment">// Select the expiry as the nearest to set days later</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            var contracts = GetContractsForExpiry(AllSymbols, minDaysTillExpiry).ToList();</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            var calls = contracts.Where(x =&gt; x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call &amp;&amp; x.ID.StrikePrice &gt; <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a>).ToList();</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            var puts = contracts.Where(x =&gt; x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put &amp;&amp; x.ID.StrikePrice &lt; <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a>).ToList();</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            <span class="keywordflow">if</span> (calls.Count == 0 || puts.Count == 0)</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            <span class="comment">// Select the strike prices with the set spread range</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            var nearCallStrike = GetStrike(calls, nearStrikeSpread);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            var nearPutStrike = GetStrike(puts, -nearStrikeSpread);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            var farCallStrike = GetStrike(calls.Where(x =&gt; x.ID.StrikePrice &gt; nearCallStrike), farStrikeSpread);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            var farPutStrike = -1m;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <span class="keywordflow">if</span> (farCallStrike != decimal.MaxValue)</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            {</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                farPutStrike = nearPutStrike - farCallStrike + nearCallStrike;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <span class="comment">// Select the contracts</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            var filtered = this.Where(x =&gt;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                x.ID.Date == contracts[0].ID.Date &amp;&amp; (</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                (x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call &amp;&amp; x.ID.StrikePrice == nearCallStrike) ||</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                (x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put &amp;&amp; x.ID.StrikePrice == nearPutStrike) ||</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                (x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call &amp;&amp; x.ID.StrikePrice == farCallStrike) ||</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                (x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put &amp;&amp; x.ID.StrikePrice == farPutStrike)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            ));</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keywordflow">if</span> (filtered.Count() != 4)</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            {</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            <span class="keywordflow">return</span> filtered;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">        /// Sets universe of an OTM call, an ITM call, an OTM put, and an ITM put with the same expiry with closest match to the criteria given.</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">        /// The OTM call has the same strike as the ITM put, while the same holds for the ITM call and the OTM put</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">        /// &lt;param name=&quot;strikeSpread&quot;&gt;The desire strike price distance of the OTM call and the OTM put from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Long and Short Box Spread Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00708"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#af2e4fd1b7f41b888d94a412d53c913f9">  708</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#af2e4fd1b7f41b888d94a412d53c913f9" title="Sets universe of an OTM call, an ITM call, an OTM put, and an ITM put with the same expiry with close...">BoxSpread</a>(<span class="keywordtype">int</span> minDaysTillExpiry = 30, decimal strikeSpread = 5)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <span class="keywordflow">if</span> (strikeSpread &lt;= 0)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException($<span class="stringliteral">&quot;BoxSpread(): strike arguments must be positive, {nameof(strikeSpread)}&quot;</span>);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="comment">// Select the expiry as the nearest to set days later</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            var contracts = GetContractsForExpiry(AllSymbols, minDaysTillExpiry).ToList();</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            <span class="keywordflow">if</span> (contracts.Count == 0)</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="comment">// Select the strike prices with the set spread range</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            var higherStrike = GetStrike(contracts.Where(x =&gt; x.ID.StrikePrice &gt; <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a>), strikeSpread);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            var lowerStrike = GetStrike(contracts.Where(x =&gt; x.ID.StrikePrice &lt; higherStrike &amp;&amp; x.ID.StrikePrice &lt; <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a>), -strikeSpread);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            <span class="comment">// Select the contracts</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            var filtered = this.Where(x =&gt;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                (x.ID.StrikePrice == higherStrike || x.ID.StrikePrice == lowerStrike) &amp;&amp;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                x.ID.Date == contracts[0].ID.Date);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="keywordflow">if</span> (filtered.Count() != 4)</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="keywordflow">return</span> filtered;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        }</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">        /// Sets universe of 2 call and 2 put contracts with the same strike price and 2 expiration dates, with closest match to the criteria given</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">        /// &lt;param name=&quot;strikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price&lt;/param&gt;</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">        /// &lt;param name=&quot;minNearDaysTillExpiry&quot;&gt;The mininum days till expiry of the closer contract from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">        /// &lt;param name=&quot;minFarDaysTillExpiry&quot;&gt;The mininum days till expiry of the further conrtact from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Long and Short Jelly Roll Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00745"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a8c4d8f2e19beca8e4a01dc4cfa12c412">  745</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a8c4d8f2e19beca8e4a01dc4cfa12c412" title="Sets universe of 2 call and 2 put contracts with the same strike price and 2 expiration dates,...">JellyRoll</a>(decimal strikeFromAtm = 0, <span class="keywordtype">int</span> minNearDaysTillExpiry = 30, <span class="keywordtype">int</span> minFarDaysTillExpiry = 60)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordflow">if</span> (minFarDaysTillExpiry &lt;= minNearDaysTillExpiry)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;JellyRoll(): expiry arguments must be in ascending order, &quot;</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                    + $<span class="stringliteral">&quot;{nameof(minNearDaysTillExpiry)}, {nameof(minFarDaysTillExpiry)}&quot;</span>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            }</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <span class="keywordflow">if</span> (minNearDaysTillExpiry &lt; 0)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            {</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;JellyRoll(): near expiry argument must be positive.&quot;</span>);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            <span class="comment">// Select the set strike</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            var strike = AllSymbols.OrderBy(x =&gt; Math.Abs(<a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a> - x.ID.StrikePrice + strikeFromAtm))</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                .First().ID.StrikePrice;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            var contracts = AllSymbols.Where(x =&gt; x.ID.StrikePrice == strike &amp;&amp; x.ID.OptionRight == <a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call).ToList();</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            <span class="comment">// Select the expiries</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            var nearExpiryContract = GetContractsForExpiry(contracts, minNearDaysTillExpiry).SingleOrDefault();</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            <span class="keywordflow">if</span> (nearExpiryContract == <span class="keyword">null</span>)</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            }</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            var nearExpiry = nearExpiryContract.ID.Date;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            var furtherContracts = contracts.Where(x =&gt; x.ID.Date &gt; nearExpiryContract.ID.Date).ToList();</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            var farExpiryContract = GetContractsForExpiry(furtherContracts, minFarDaysTillExpiry).SingleOrDefault();</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <span class="keywordflow">if</span> (farExpiryContract == <span class="keyword">null</span>)</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            {</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            }</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            var farExpiry = farExpiryContract.ID.Date;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160; </div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            var filtered = this.Where(x =&gt; x.ID.StrikePrice == strike &amp;&amp; (x.ID.Date == nearExpiry || x.ID.Date == farExpiry));</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="keywordflow">if</span> (filtered.Count() != 4)</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            <span class="keywordflow">return</span> filtered;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">        /// Sets universe of 3 call contracts with the same expiry and different strike prices, with closest match to the criteria given</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">        /// &lt;param name=&quot;higherStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the higher strike price&lt;/param&gt;</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">        /// &lt;param name=&quot;middleStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the middle strike price&lt;/param&gt;</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">        /// &lt;param name=&quot;lowerStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the lower strike price&lt;/param&gt;</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Bear Call Ladder and Bull Call Ladder Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00796"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aa5cd17a8130a4dbeec30336d08c528c7">  796</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aa5cd17a8130a4dbeec30336d08c528c7" title="Sets universe of 3 call contracts with the same expiry and different strike prices,...">CallLadder</a>(<span class="keywordtype">int</span> minDaysTillExpiry, decimal higherStrikeFromAtm, decimal middleStrikeFromAtm, decimal lowerStrikeFromAtm)</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="keywordflow">return</span> Ladder(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Call, minDaysTillExpiry, higherStrikeFromAtm, middleStrikeFromAtm, lowerStrikeFromAtm);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">        /// Sets universe of 3 put contracts with the same expiry and different strike prices, with closest match to the criteria given</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The minimum days till expiry from the current time, closest expiry will be selected&lt;/param&gt;</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment">        /// &lt;param name=&quot;higherStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the higher strike price&lt;/param&gt;</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">        /// &lt;param name=&quot;middleStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the middle strike price&lt;/param&gt;</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">        /// &lt;param name=&quot;lowerStrikeFromAtm&quot;&gt;The desire strike price distance from the current underlying price of the lower strike price&lt;/param&gt;</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">        /// &lt;remarks&gt;Applicable to Bear Put Ladder and Bull Put Ladder Option Strategy&lt;/remarks&gt;</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00810"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a4fcf2ac35cd1a88b4b04a012029ebf32">  810</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a4fcf2ac35cd1a88b4b04a012029ebf32" title="Sets universe of 3 put contracts with the same expiry and different strike prices,...">PutLadder</a>(<span class="keywordtype">int</span> minDaysTillExpiry, decimal higherStrikeFromAtm, decimal middleStrikeFromAtm, decimal lowerStrikeFromAtm)</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        {</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <span class="keywordflow">return</span> Ladder(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a>.Put, minDaysTillExpiry, higherStrikeFromAtm, middleStrikeFromAtm, lowerStrikeFromAtm);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with Delta between the given range</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum Delta value&lt;/param&gt;</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum Delta value&lt;/param&gt;</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00821"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a15e2e47a7372d5556a147a7f2cf722b5">  821</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a15e2e47a7372d5556a147a7f2cf722b5" title="Applies the filter to the universe selecting the contracts with Delta between the given range">Delta</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        {</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            <span class="keywordflow">return</span> this.Where(contractData =&gt; contractData.Greeks.Delta &gt;= min &amp;&amp; contractData.Greeks.Delta &lt;= max);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with Delta between the given range.</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">        /// Alias for &lt;see cref=&quot;Delta(decimal, decimal)&quot;/&gt;</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum Delta value&lt;/param&gt;</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum Delta value&lt;/param&gt;</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00833"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#add3a48b05334a2d69bbb5909dce45f64">  833</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#add3a48b05334a2d69bbb5909dce45f64" title="Applies the filter to the universe selecting the contracts with Delta between the given range....">D</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a15e2e47a7372d5556a147a7f2cf722b5" title="Applies the filter to the universe selecting the contracts with Delta between the given range">Delta</a>(min, max);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with Gamma between the given range</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum Gamma value&lt;/param&gt;</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum Gamma value&lt;/param&gt;</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00844"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ada13e54e8b4a189f9cb78abe7d9b9d9e">  844</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ada13e54e8b4a189f9cb78abe7d9b9d9e" title="Applies the filter to the universe selecting the contracts with Gamma between the given range">Gamma</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="keywordflow">return</span> this.Where(contractData =&gt; contractData.Greeks.Gamma &gt;= min &amp;&amp; contractData.Greeks.Gamma &lt;= max);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        }</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with Gamma between the given range.</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">        /// Alias for &lt;see cref=&quot;Gamma(decimal, decimal)&quot;/&gt;</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum Gamma value&lt;/param&gt;</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum Gamma value&lt;/param&gt;</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00856"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a3e2736713afd7dbb6eace0a23738ff3c">  856</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a3e2736713afd7dbb6eace0a23738ff3c" title="Applies the filter to the universe selecting the contracts with Gamma between the given range....">G</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ada13e54e8b4a189f9cb78abe7d9b9d9e" title="Applies the filter to the universe selecting the contracts with Gamma between the given range">Gamma</a>(min, max);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with Theta between the given range</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum Theta value&lt;/param&gt;</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum Theta value&lt;/param&gt;</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00867"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ac2c3fd8d213602b94bfc5fccbee4c07c">  867</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ac2c3fd8d213602b94bfc5fccbee4c07c" title="Applies the filter to the universe selecting the contracts with Theta between the given range">Theta</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <span class="keywordflow">return</span> this.Where(contractData =&gt; contractData.Greeks.Theta &gt;= min &amp;&amp; contractData.Greeks.Theta &lt;= max);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        }</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with Theta between the given range.</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">        /// Alias for &lt;see cref=&quot;Theta(decimal, decimal)&quot;/&gt;</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum Theta value&lt;/param&gt;</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum Theta value&lt;/param&gt;</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00879"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a3bc1cc594e5ea96009f355b40fe45f23">  879</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a3bc1cc594e5ea96009f355b40fe45f23" title="Applies the filter to the universe selecting the contracts with Theta between the given range....">T</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ac2c3fd8d213602b94bfc5fccbee4c07c" title="Applies the filter to the universe selecting the contracts with Theta between the given range">Theta</a>(min, max);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        }</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with Vega between the given range</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum Vega value&lt;/param&gt;</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum Vega value&lt;/param&gt;</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00890"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a160190f66c5ea6bafc4033d7cc0f09c3">  890</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a160190f66c5ea6bafc4033d7cc0f09c3" title="Applies the filter to the universe selecting the contracts with Vega between the given range">Vega</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        {</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            <span class="keywordflow">return</span> this.Where(contractData =&gt; contractData.Greeks.Vega &gt;= min &amp;&amp; contractData.Greeks.Vega &lt;= max);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with Vega between the given range.</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">        /// Alias for &lt;see cref=&quot;Vega(decimal, decimal)&quot;/&gt;</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum Vega value&lt;/param&gt;</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum Vega value&lt;/param&gt;</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00902"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a775b2daa619c3ca082fd5d622f32d1df">  902</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a775b2daa619c3ca082fd5d622f32d1df" title="Applies the filter to the universe selecting the contracts with Vega between the given range....">V</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        {</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a160190f66c5ea6bafc4033d7cc0f09c3" title="Applies the filter to the universe selecting the contracts with Vega between the given range">Vega</a>(min, max);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        }</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with Rho between the given range</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum Rho value&lt;/param&gt;</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum Rho value&lt;/param&gt;</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00913"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ab3c9bd9412a4679b0eab86891ea20d5b">  913</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ab3c9bd9412a4679b0eab86891ea20d5b" title="Applies the filter to the universe selecting the contracts with Rho between the given range">Rho</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="keywordflow">return</span> this.Where(contractData =&gt; contractData.Greeks.Rho &gt;= min &amp;&amp; contractData.Greeks.Rho &lt;= max);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with Rho between the given range.</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">        /// Alias for &lt;see cref=&quot;Rho(decimal, decimal)&quot;/&gt;</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum Rho value&lt;/param&gt;</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum Rho value&lt;/param&gt;</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00925"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a9741c0f383bac5e52533a65ed7047828">  925</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a9741c0f383bac5e52533a65ed7047828" title="Applies the filter to the universe selecting the contracts with Rho between the given range....">R</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#ab3c9bd9412a4679b0eab86891ea20d5b" title="Applies the filter to the universe selecting the contracts with Rho between the given range">Rho</a>(min, max);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with implied volatility between the given range</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum implied volatility value&lt;/param&gt;</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum implied volatility value&lt;/param&gt;</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00936"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a73e4277dd9e74a2151c2d80dcd7056e8">  936</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a73e4277dd9e74a2151c2d80dcd7056e8" title="Applies the filter to the universe selecting the contracts with implied volatility between the given ...">ImpliedVolatility</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            <span class="keywordflow">return</span> this.Where(contractData =&gt; contractData.ImpliedVolatility &gt;= min &amp;&amp; contractData.ImpliedVolatility &lt;= max);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with implied volatility between the given range.</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">        /// Alias for &lt;see cref=&quot;ImpliedVolatility(decimal, decimal)&quot;/&gt;</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum implied volatility value&lt;/param&gt;</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum implied volatility value&lt;/param&gt;</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00948"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a45361eeff00be3bd91bf3ef2569da14b">  948</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a45361eeff00be3bd91bf3ef2569da14b" title="Applies the filter to the universe selecting the contracts with implied volatility between the given ...">IV</a>(decimal min, decimal max)</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        {</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a73e4277dd9e74a2151c2d80dcd7056e8" title="Applies the filter to the universe selecting the contracts with implied volatility between the given ...">ImpliedVolatility</a>(min, max);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        }</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with open interest between the given range</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum open interest value&lt;/param&gt;</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum open interest value&lt;/param&gt;</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00959"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a61c9161fd5971ab92a4f6d48dd2f0b24">  959</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a61c9161fd5971ab92a4f6d48dd2f0b24" title="Applies the filter to the universe selecting the contracts with open interest between the given range">OpenInterest</a>(<span class="keywordtype">long</span> min, <span class="keywordtype">long</span> max)</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <span class="keywordflow">return</span> this.Where(contractData =&gt; contractData.OpenInterest &gt;= min &amp;&amp; contractData.OpenInterest &lt;= max);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment">        /// Applies the filter to the universe selecting the contracts with open interest between the given range.</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">        /// Alias for &lt;see cref=&quot;OpenInterest(long, long)&quot;/&gt;</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">        /// &lt;param name=&quot;min&quot;&gt;The minimum open interest value&lt;/param&gt;</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">        /// &lt;param name=&quot;max&quot;&gt;The maximum open interest value&lt;/param&gt;</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l00971"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a7295460e2b86311b9166b12351b0007d">  971</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a7295460e2b86311b9166b12351b0007d" title="Applies the filter to the universe selecting the contracts with open interest between the given range...">OI</a>(<span class="keywordtype">long</span> min, <span class="keywordtype">long</span> max)</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        {</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#a61c9161fd5971ab92a4f6d48dd2f0b24" title="Applies the filter to the universe selecting the contracts with open interest between the given range">OpenInterest</a>(min, max);</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        }</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">        /// Implicitly convert the universe to a list of symbols</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment"></span><span class="preprocessor">#pragma warning disable CA1002 // Do not expose generic lists</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="preprocessor">#pragma warning disable CA2225 // Operator overloads have named alternates</span></div>
<div class="line"><a name="l00982"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aa786fed333edf07d6e0b319ba6f4926b">  982</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">static</span> implicit <span class="keyword">operator</span> List&lt;Symbol&gt;(<a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> universe)</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        {</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            <span class="keywordflow">return</span> universe.AllSymbols.ToList();</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        }</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="preprocessor">#pragma warning restore CA2225 // Operator overloads have named alternates</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="preprocessor">#pragma warning restore CA1002 // Do not expose generic lists</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> Ladder(<a class="code" href="namespaceQuantConnect.html#a0dda2dc2456afd7812708a3a2715badb" title="Specifies the different types of options">OptionRight</a> right, <span class="keywordtype">int</span> minDaysTillExpiry, decimal higherStrikeFromAtm, decimal middleStrikeFromAtm, decimal lowerStrikeFromAtm)</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <span class="keywordflow">if</span> (higherStrikeFromAtm &lt;= lowerStrikeFromAtm || higherStrikeFromAtm &lt;= middleStrikeFromAtm || middleStrikeFromAtm &lt;= lowerStrikeFromAtm)</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            {</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;Ladder(): strike price arguments must be in descending order, &quot;</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                    + $<span class="stringliteral">&quot;{nameof(higherStrikeFromAtm)}, {nameof(middleStrikeFromAtm)}, {nameof(lowerStrikeFromAtm)}&quot;</span>);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            }</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            <span class="comment">// Select the expiry as the nearest to set days later</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            var contracts = GetContractsForExpiry(AllSymbols.Where(x =&gt; x.ID.OptionRight == right).ToList(), minDaysTillExpiry);</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            <span class="comment">// Select the strike prices with the set ladder range</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            var lowerStrikeContract = contracts.OrderBy(x =&gt; Math.Abs(<a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a> - x.ID.StrikePrice + lowerStrikeFromAtm)).First();</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            var middleStrikeContract = contracts.Where(x =&gt; x.ID.StrikePrice &gt; lowerStrikeContract.ID.StrikePrice)</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                .OrderBy(x =&gt; Math.Abs(<a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a> - x.ID.StrikePrice + middleStrikeFromAtm)).FirstOrDefault();</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <span class="keywordflow">if</span> (middleStrikeContract == <span class="keywordflow">default</span>)</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            {</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            }</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            var higherStrikeContract = contracts.Where(x =&gt; x.ID.StrikePrice &gt; middleStrikeContract.ID.StrikePrice)</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                .OrderBy(x =&gt; Math.Abs(<a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a> - x.ID.StrikePrice + higherStrikeFromAtm)).FirstOrDefault();</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="keywordflow">if</span> (higherStrikeContract == <span class="keywordflow">default</span>)</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            {</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                <span class="keywordflow">return</span> Empty();</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            }</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;            <span class="keywordflow">return</span> this.WhereContains(<span class="keyword">new</span> List&lt;Symbol&gt; { lowerStrikeContract, middleStrikeContract, higherStrikeContract });</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">        /// Will provide all contracts that respect a specific expiration filter</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">        /// &lt;param name=&quot;symbols&quot;&gt;Symbols source to use&lt;/param&gt;</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">        /// &lt;param name=&quot;minDaysTillExpiry&quot;&gt;The desired minimum days till expiry&lt;/param&gt;</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">        /// &lt;returns&gt;All symbols that respect a single expiration date&lt;/returns&gt;</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> IEnumerable&lt;Symbol&gt; GetContractsForExpiry(IEnumerable&lt;Symbol&gt; symbols, <span class="keywordtype">int</span> minDaysTillExpiry)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            var leastExpiryAccepted = _lastExchangeDate.AddDays(minDaysTillExpiry);</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            <span class="keywordflow">return</span> symbols.Where(x =&gt; x.ID.Date &gt;= leastExpiryAccepted)</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                .GroupBy(x =&gt; x.ID.Date)</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                .OrderBy(x =&gt; x.Key)</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                .FirstOrDefault()</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                <span class="comment">// let&#39;s order the symbols too, to guarantee determinism</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                ?.OrderBy(x =&gt; x.ID) ?? Enumerable.Empty&lt;Symbol&gt;();</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        }</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">        /// Helper method that will select no contract</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb13b7e2b9e6e9b2e59df656faf1f46f" title="Constructs OptionFilterUniverse">OptionFilterUniverse</a> Empty()</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        {</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            Data = Enumerable.Empty&lt;<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1OptionUniverse.html" title="Represents a universe of options data">OptionUniverse</a>&gt;();</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        }</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">        /// Helper method that will select the given contract list</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#adb13b7e2b9e6e9b2e59df656faf1f46f" title="Constructs OptionFilterUniverse">OptionFilterUniverse</a> SymbolList(List&lt;Symbol&gt; contracts)</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        {</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            AllSymbols = contracts;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        }</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160; </div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="keyword">private</span> decimal GetStrike(IEnumerable&lt;Symbol&gt; symbols, decimal strikeFromAtm)</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            <span class="keywordflow">return</span> symbols.OrderBy(x =&gt; Math.Abs(<a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html#aae9ff4f72e038ebb0114f048b1c38366" title="The underlying price data">Underlying</a>.<a class="code" href="classQuantConnect_1_1Data_1_1BaseData.html#ad4fd02bd765a6633c544104eb94531fb" title="As this is a backtesting platform we&#39;ll provide an alias of value as price.">Price</a> + strikeFromAtm - x.ID.StrikePrice))</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                .Select(x =&gt; x.ID.StrikePrice)</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                .DefaultIfEmpty(decimal.MaxValue)</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                .First();</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        }</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    }</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">    /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">    /// Extensions for Linq support</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">    /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html"> 1065</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class </span><a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html" title="Extensions for Linq support">OptionFilterUniverseEx</a></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    {<span class="comment"></span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">        /// Filters universe</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;Universe to apply the filter too&lt;/param&gt;</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">        /// &lt;param name=&quot;predicate&quot;&gt;Bool function to determine which Symbol are filtered&lt;/param&gt;</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#aef35e2ffb326fc54deb22b3f05d8c4f3"> 1073</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#aef35e2ffb326fc54deb22b3f05d8c4f3" title="Filters universe">Where</a>(<span class="keyword">this</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> universe, Func&lt;OptionUniverse, bool&gt; predicate)</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            universe.Data = universe.Data.Where(predicate).ToList();</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            <span class="keywordflow">return</span> universe;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        }</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">        /// Filters universe</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;Universe to apply the filter too&lt;/param&gt;</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">        /// &lt;param name=&quot;predicate&quot;&gt;Bool function to determine which Symbol are filtered&lt;/param&gt;</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#a68c7e0cdb6ce71b028039b702ab328e7"> 1085</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#a68c7e0cdb6ce71b028039b702ab328e7" title="Filters universe">Where</a>(<span class="keyword">this</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> universe, PyObject predicate)</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        {</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            universe.Data = universe.Data.Where(predicate.ConvertToDelegate&lt;Func&lt;OptionUniverse, bool&gt;&gt;()).ToList();</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <span class="keywordflow">return</span> universe;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        }</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">        /// Maps universe</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;Universe to apply the filter too&lt;/param&gt;</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">        /// &lt;param name=&quot;mapFunc&quot;&gt;Symbol function to determine which Symbols are filtered&lt;/param&gt;</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#a3b68d4d447a4820b045311868788e3cd"> 1097</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#a3b68d4d447a4820b045311868788e3cd" title="Maps universe">Select</a>(<span class="keyword">this</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> universe, Func&lt;OptionUniverse, Symbol&gt; mapFunc)</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        {</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            universe.AllSymbols = universe.Data.Select(mapFunc).ToList();</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            <span class="keywordflow">return</span> universe;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">        /// Maps universe</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;Universe to apply the filter too&lt;/param&gt;</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">        /// &lt;param name=&quot;mapFunc&quot;&gt;Symbol function to determine which Symbols are filtered&lt;/param&gt;</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#a5066b17d8368a54c0e0524fc4473282a"> 1109</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#a5066b17d8368a54c0e0524fc4473282a" title="Maps universe">Select</a>(<span class="keyword">this</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> universe, PyObject mapFunc)</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        {</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            <span class="keywordflow">return</span> universe.Select(mapFunc.ConvertToDelegate&lt;Func&lt;OptionUniverse, Symbol&gt;&gt;());</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        }</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">        /// Binds universe</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;Universe to apply the filter too&lt;/param&gt;</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">        /// &lt;param name=&quot;mapFunc&quot;&gt;Symbol function to determine which Symbols are filtered&lt;/param&gt;</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#ae7b711c491fb12095b9b0d74a61400ea"> 1120</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#ae7b711c491fb12095b9b0d74a61400ea" title="Binds universe">SelectMany</a>(<span class="keyword">this</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> universe, Func&lt;<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1OptionUniverse.html" title="Represents a universe of options data">OptionUniverse</a>, IEnumerable&lt;Symbol&gt;&gt; mapFunc)</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        {</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            universe.AllSymbols = universe.Data.SelectMany(mapFunc).ToList();</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            <span class="keywordflow">return</span> universe;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        }</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">        /// Binds universe</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;Universe to apply the filter too&lt;/param&gt;</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">        /// &lt;param name=&quot;mapFunc&quot;&gt;Symbol function to determine which Symbols are filtered&lt;/param&gt;</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#a2cf23759394ccad64887a057e5d2a754"> 1132</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#a2cf23759394ccad64887a057e5d2a754" title="Binds universe">SelectMany</a>(<span class="keyword">this</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> universe, PyObject mapFunc)</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        {</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;            <span class="keywordflow">return</span> universe.SelectMany(mapFunc.ConvertToDelegate&lt;Func&lt;<a class="code" href="classQuantConnect_1_1Data_1_1UniverseSelection_1_1OptionUniverse.html" title="Represents a universe of options data">OptionUniverse</a>, IEnumerable&lt;Symbol&gt;&gt;&gt;());</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        }</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">        /// Updates universe to only contain the symbols in the list</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;Universe to apply the filter too&lt;/param&gt;</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment">        /// &lt;param name=&quot;filterList&quot;&gt;List of Symbols to keep in the Universe&lt;/param&gt;</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#ae2bda9f8974c7bb390f421cad74acbd9"> 1143</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#ae2bda9f8974c7bb390f421cad74acbd9" title="Updates universe to only contain the symbols in the list">WhereContains</a>(<span class="keyword">this</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> universe, List&lt;Symbol&gt; filterList)</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        {</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            universe.Data = universe.Data.Where(x =&gt; filterList.Contains(x)).ToList();</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            <span class="keywordflow">return</span> universe;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        }</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">        /// Updates universe to only contain the symbols in the list</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">        /// &lt;param name=&quot;universe&quot;&gt;Universe to apply the filter too&lt;/param&gt;</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">        /// &lt;param name=&quot;filterList&quot;&gt;List of Symbols to keep in the Universe&lt;/param&gt;</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">        /// &lt;returns&gt;Universe with filter applied&lt;/returns&gt;</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"><a class="line" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#a8d0c0918da4d32edf39f2219169aca1f"> 1155</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverseEx.html#a8d0c0918da4d32edf39f2219169aca1f" title="Updates universe to only contain the symbols in the list">WhereContains</a>(<span class="keyword">this</span> <a class="code" href="classQuantConnect_1_1Securities_1_1OptionFilterUniverse.html" title="Represents options symbols universe used in filtering.">OptionFilterUniverse</a> universe, PyObject filterList)</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        {</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            <span class="keywordflow">return</span> universe.WhereContains(filterList.ConvertToSymbolEnumerable().ToList());</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_4ab6b4cc6a7edbff49100e9123df213f.html">Common</a></li><li class="navelem"><a class="el" href="dir_4002bdd9f4b1a6ee3703d6414aeb1b9a.html">Securities</a></li><li class="navelem"><a class="el" href="dir_279f131bb62e047e5c2fc1ef67ed2f45.html">Option</a></li><li class="navelem"><b>OptionFilterUniverse.cs</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
